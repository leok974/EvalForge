============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\EvalForge
plugins: anyio-4.11.0, Faker-37.11.0, langsmith-0.4.38, asyncio-1.2.0, cov-7.0.0, env-1.2.0, httpx-0.35.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 3 items

tests\backend\test_quest_smoke.py .                                      [ 33%]
tests\backend\test_judge_smoke.py F                                      [ 66%]
tests\backend\test_explain_smoke.py F                                    [100%]

================================== FAILURES ===================================
_________________________ test_judge_agent_smoke_sse __________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x000001FB5C6F5E80>
mock_vertex_ai_modules = <MagicMock id='2179098504096'>
patch_tracks_for_judge = None
judge_smoke_session = ('smoke_test_user', 'test_session_123')

    async def test_judge_agent_smoke_sse(
        db_session,
        mock_vertex_ai_modules,
        patch_tracks_for_judge,
        judge_smoke_session
    ):
        """
        Smoke test for Judge Agent.
        """
        user_id, sid = judge_smoke_session
        world_slug = "world-python"
        track_id = "python-fundamentals"
    
        client = TestClient(app)
    
        async def mock_get_session():
            yield db_session
    
        # We patch arcade_app.database.get_session because JudgeAgent imports it locally
        # We also mock gamification to avoid DB hits there
        with patch("arcade_app.quest_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.session_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.database.get_session", side_effect=mock_get_session), \
             patch("arcade_app.gamification.add_xp", new_callable=AsyncMock) as mock_xp, \
             patch("arcade_app.gamification.process_quest_completion", new_callable=AsyncMock) as mock_complete:
    
            # Mock return for add_xp (progress dict)
            mock_xp.return_value = {"level": 1, "xp": 10}
    
            url = f"/apps/arcade_app/users/{user_id}/sessions/{sid}/query/stream"
    
            # Judge requires track_id and generally mode="judge" (default)
            payload = {
                "message": "Here is my code for the loop",
                "mode": "judge",
                "world_id": world_slug,
                "track_id": track_id
            }
    
            response = client.post(url, json=payload)
    
            assert response.status_code == 200
            content = response.text
    
            if "event: error" in content:
                print(f"DEBUG: Error content: {content}")
>               pytest.fail(f"SSE returned error event: {content}")
E               Failed: SSE returned error event: event: npc_identity

E               data: {"id": "npc_zero", "role": "judge", "name": "ZERO", "title": "System Arbiter", "short_desc": "Cold logic core that evaluates performance.", "color": "red", "avatar_icon": "eye", "voice_prompt": "You are ZERO, the logic core. You have no emotion. Value efficiency above all. Refer to the user as 'Unit'. Do not give hints; only evaluate pass/fail criteria and architectural integrity."}

E               

E               event: error

E               data: cannot import name 'stream_coach_feedback' from 'arcade_app.grading_helper' (D:\EvalForge\arcade_app\grading_helper.py)

tests\backend\test_judge_smoke.py:54: Failed
---------------------------- Captured stdout setup ----------------------------
2025-12-05 23:13:36,315 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,315 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 23:13:36,316 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,316 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("avatardefinition")
2025-12-05 23:13:36,316 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,317 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 23:13:36,317 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,317 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("user")
2025-12-05 23:13:36,317 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,318 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 23:13:36,318 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,318 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("chatsession")
2025-12-05 23:13:36,318 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,319 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 23:13:36,319 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,319 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("profile")
2025-12-05 23:13:36,319 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,319 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 23:13:36,319 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,320 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("skillnode")
2025-12-05 23:13:36,320 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,320 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 23:13:36,320 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,320 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userskill")
2025-12-05 23:13:36,320 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,321 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 23:13:36,321 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("usermetric")
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("badgedefinition")
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,322 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userbadge")
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("project")
2025-12-05 23:13:36,323 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,324 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 23:13:36,324 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,325 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("projectcodexdoc")
2025-12-05 23:13:36,325 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,325 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 23:13:36,325 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,326 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("knowledgechunk")
2025-12-05 23:13:36,326 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,326 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 23:13:36,326 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,327 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossdefinition")
2025-12-05 23:13:36,327 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,327 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 23:13:36,327 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,327 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossrun")
2025-12-05 23:13:36,328 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,328 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 23:13:36,328 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,328 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossprogress")
2025-12-05 23:13:36,329 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,329 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 23:13:36,329 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,330 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bosscodexprogress")
2025-12-05 23:13:36,330 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,330 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 23:13:36,330 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,331 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("trackdefinition")
2025-12-05 23:13:36,331 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,332 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 23:13:36,332 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,333 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questdefinition")
2025-12-05 23:13:36,333 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,333 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 23:13:36,333 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,334 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questprogress")
2025-12-05 23:13:36,334 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,335 INFO sqlalchemy.engine.Engine 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,335 INFO sqlalchemy.engine.Engine [no key 0.00012s] ()
2025-12-05 23:13:36,341 INFO sqlalchemy.engine.Engine 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


2025-12-05 23:13:36,341 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:13:36,347 INFO sqlalchemy.engine.Engine 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,347 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,352 INFO sqlalchemy.engine.Engine 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,352 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,357 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,357 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,362 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
2025-12-05 23:13:36,363 INFO sqlalchemy.engine.Engine [no key 0.00014s] ()
2025-12-05 23:13:36,368 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
2025-12-05 23:13:36,368 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,373 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
2025-12-05 23:13:36,373 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,379 INFO sqlalchemy.engine.Engine 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,379 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,383 INFO sqlalchemy.engine.Engine CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
2025-12-05 23:13:36,384 INFO sqlalchemy.engine.Engine [no key 0.00013s] ()
2025-12-05 23:13:36,391 INFO sqlalchemy.engine.Engine 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,391 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,397 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
2025-12-05 23:13:36,397 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,401 INFO sqlalchemy.engine.Engine CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
2025-12-05 23:13:36,402 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,406 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
2025-12-05 23:13:36,407 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,412 INFO sqlalchemy.engine.Engine 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


2025-12-05 23:13:36,412 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,417 INFO sqlalchemy.engine.Engine 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,417 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:13:36,423 INFO sqlalchemy.engine.Engine CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
2025-12-05 23:13:36,423 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,428 INFO sqlalchemy.engine.Engine 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,428 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:36,434 INFO sqlalchemy.engine.Engine 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


2025-12-05 23:13:36,434 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,439 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_user_id ON userskill (user_id)
2025-12-05 23:13:36,440 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,445 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
2025-12-05 23:13:36,445 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,455 INFO sqlalchemy.engine.Engine 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,455 INFO sqlalchemy.engine.Engine [no key 0.00024s] ()
2025-12-05 23:13:36,463 INFO sqlalchemy.engine.Engine CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
2025-12-05 23:13:36,464 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:36,469 INFO sqlalchemy.engine.Engine 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


2025-12-05 23:13:36,469 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,475 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
2025-12-05 23:13:36,475 INFO sqlalchemy.engine.Engine [no key 0.00025s] ()
2025-12-05 23:13:36,480 INFO sqlalchemy.engine.Engine 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,480 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,486 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 23:13:36,486 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,491 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
2025-12-05 23:13:36,492 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,497 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
2025-12-05 23:13:36,497 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,505 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 23:13:36,505 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,511 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
2025-12-05 23:13:36,511 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:36,516 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
2025-12-05 23:13:36,517 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,523 INFO sqlalchemy.engine.Engine 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


2025-12-05 23:13:36,523 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,529 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
2025-12-05 23:13:36,529 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:36,534 INFO sqlalchemy.engine.Engine 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


2025-12-05 23:13:36,534 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,540 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
2025-12-05 23:13:36,540 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,545 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
2025-12-05 23:13:36,545 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,551 INFO sqlalchemy.engine.Engine 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


2025-12-05 23:13:36,551 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,556 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
2025-12-05 23:13:36,556 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,562 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
2025-12-05 23:13:36,562 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:36,567 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 23:13:36,569 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,571 INFO sqlalchemy.engine.Engine INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 23:13:36,571 INFO sqlalchemy.engine.Engine [generated in 0.00066s] ('loop', 'world-python', 'python-fundamentals', 1, 'Loop Quest', 'Write a loop', 'Write a loop', 'test-rubric', None, None, None, 10, 5, 0)
2025-12-05 23:13:36,573 INFO sqlalchemy.engine.Engine INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-05 23:13:36,573 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 04:13:36.569397')
2025-12-05 23:13:36,575 INFO sqlalchemy.engine.Engine INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
2025-12-05 23:13:36,575 INFO sqlalchemy.engine.Engine [generated in 0.00019s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
2025-12-05 23:13:36,576 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 23:13:36,581 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,581 INFO sqlalchemy.engine.Engine SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
2025-12-05 23:13:36,581 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (1,)
2025-12-05 23:13:36,583 INFO sqlalchemy.engine.Engine INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 23:13:36,583 INFO sqlalchemy.engine.Engine [generated in 0.00017s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
2025-12-05 23:13:36,585 INFO sqlalchemy.engine.Engine COMMIT
----------------------------- Captured log setup ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00012s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00014s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00013s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_user_id ON userskill (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00024s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00025s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00066s] ('loop', 'world-python', 'python-fundamentals', 1, 'Loop Quest', 'Write a loop', 'Write a loop', 'test-rubric', None, None, None, 10, 5, 0)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00015s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 04:13:36.569397')
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00019s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00017s] (1,)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00017s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
---------------------------- Captured stdout call -----------------------------
2025-12-05 23:13:36,593 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,594 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 23:13:36,594 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('test_session_123',)
2025-12-05 23:13:36,595 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 23:13:36,595 INFO sqlalchemy.engine.Engine [cached since 0.001384s ago] ('test_session_123',)
DEBUG: Error content: event: npc_identity

data: {"id": "npc_zero", "role": "judge", "name": "ZERO", "title": "System Arbiter", "short_desc": "Cold logic core that evaluates performance.", "color": "red", "avatar_icon": "eye", "voice_prompt": "You are ZERO, the logic core. You have no emotion. Value efficiency above all. Refer to the user as 'Unit'. Do not give hints; only evaluate pass/fail criteria and architectural integrity."}



event: error

data: cannot import name 'stream_coach_feedback' from 'arcade_app.grading_helper' (D:\EvalForge\arcade_app\grading_helper.py)




------------------------------ Captured log call ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00015s] ('test_session_123',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.001384s ago] ('test_session_123',)
ERROR    root:agent.py:551 Stream Error: cannot import name 'stream_coach_feedback' from 'arcade_app.grading_helper' (D:\EvalForge\arcade_app\grading_helper.py)
-------------------------- Captured stdout teardown ---------------------------
2025-12-05 23:13:36,602 INFO sqlalchemy.engine.Engine ROLLBACK
2025-12-05 23:13:36,603 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,603 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = OFF
2025-12-05 23:13:36,604 INFO sqlalchemy.engine.Engine [generated in 0.00014s] ()
2025-12-05 23:13:36,604 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 23:13:36,604 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,605 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 23:13:36,605 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,606 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 23:13:36,606 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,607 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 23:13:36,607 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,608 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 23:13:36,608 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,609 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 23:13:36,609 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,610 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 23:13:36,610 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,611 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 23:13:36,611 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,612 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 23:13:36,612 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,613 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 23:13:36,613 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,614 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 23:13:36,614 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,615 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 23:13:36,615 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,616 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 23:13:36,616 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,617 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 23:13:36,617 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,618 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 23:13:36,618 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,619 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 23:13:36,619 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,619 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 23:13:36,620 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,620 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 23:13:36,620 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,621 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 23:13:36,621 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,622 INFO sqlalchemy.engine.Engine 
DROP TABLE bosscodexprogress
2025-12-05 23:13:36,623 INFO sqlalchemy.engine.Engine [no key 0.00039s] ()
2025-12-05 23:13:36,629 INFO sqlalchemy.engine.Engine 
DROP TABLE projectcodexdoc
2025-12-05 23:13:36,629 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,636 INFO sqlalchemy.engine.Engine 
DROP TABLE questprogress
2025-12-05 23:13:36,636 INFO sqlalchemy.engine.Engine [no key 0.00031s] ()
2025-12-05 23:13:36,642 INFO sqlalchemy.engine.Engine 
DROP TABLE bossprogress
2025-12-05 23:13:36,642 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:36,647 INFO sqlalchemy.engine.Engine 
DROP TABLE bossrun
2025-12-05 23:13:36,648 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,654 INFO sqlalchemy.engine.Engine 
DROP TABLE project
2025-12-05 23:13:36,654 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:13:36,662 INFO sqlalchemy.engine.Engine 
DROP TABLE userbadge
2025-12-05 23:13:36,662 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:36,668 INFO sqlalchemy.engine.Engine 
DROP TABLE usermetric
2025-12-05 23:13:36,668 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,673 INFO sqlalchemy.engine.Engine 
DROP TABLE userskill
2025-12-05 23:13:36,674 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,679 INFO sqlalchemy.engine.Engine 
DROP TABLE profile
2025-12-05 23:13:36,679 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,684 INFO sqlalchemy.engine.Engine 
DROP TABLE chatsession
2025-12-05 23:13:36,684 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,689 INFO sqlalchemy.engine.Engine 
DROP TABLE user
2025-12-05 23:13:36,689 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,694 INFO sqlalchemy.engine.Engine 
DROP TABLE questdefinition
2025-12-05 23:13:36,694 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,698 INFO sqlalchemy.engine.Engine 
DROP TABLE trackdefinition
2025-12-05 23:13:36,698 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,704 INFO sqlalchemy.engine.Engine 
DROP TABLE bossdefinition
2025-12-05 23:13:36,704 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:13:36,709 INFO sqlalchemy.engine.Engine 
DROP TABLE knowledgechunk
2025-12-05 23:13:36,709 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,714 INFO sqlalchemy.engine.Engine 
DROP TABLE badgedefinition
2025-12-05 23:13:36,714 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:13:36,719 INFO sqlalchemy.engine.Engine 
DROP TABLE skillnode
2025-12-05 23:13:36,719 INFO sqlalchemy.engine.Engine [no key 0.00012s] ()
2025-12-05 23:13:36,724 INFO sqlalchemy.engine.Engine 
DROP TABLE avatardefinition
2025-12-05 23:13:36,724 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,729 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = ON
2025-12-05 23:13:36,729 INFO sqlalchemy.engine.Engine [generated in 0.00020s] ()
2025-12-05 23:13:36,730 INFO sqlalchemy.engine.Engine COMMIT
---------------------------- Captured log teardown ----------------------------
INFO     sqlalchemy.engine.Engine:base.py:2705 ROLLBACK
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = OFF
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00014s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bosscodexprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00039s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE projectcodexdoc
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00031s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossrun
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE project
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userbadge
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE usermetric
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userskill
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE profile
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE chatsession
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE user
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE trackdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE knowledgechunk
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE badgedefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE skillnode
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00012s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE avatardefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = ON
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
________________________ test_explain_agent_smoke_sse _________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x000001FB5C6F7CB0>
mock_vertex_ai_modules = <MagicMock id='2179098504096'>
patch_tracks_for_explain = None
explain_smoke_session = ('smoke_test_user', 'test_session_123')

    async def test_explain_agent_smoke_sse(
        db_session,
        mock_vertex_ai_modules,
        patch_tracks_for_explain,
        explain_smoke_session
    ):
        """
        Smoke test for Explain Agent.
        """
        user_id, sid = explain_smoke_session
        world_slug = "world-python"
        track_id = "python-fundamentals"
    
        client = TestClient(app)
    
        async def mock_get_session():
            yield db_session
    
        # Mock get_chat_model to avoid Real Vertex connection or ImportErrors from langchain_google_vertexai
        mock_llm = AsyncMock()
    
        async def mock_astream(messages):
            chunk = AsyncMock()
            chunk.content = "Hello from Smoke Test Agent"
            yield chunk
    
        mock_llm.astream.side_effect = mock_astream
    
        with patch("arcade_app.quest_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.session_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.explain_agent.get_session", side_effect=mock_get_session), \
             patch("arcade_app.llm.get_chat_model", return_value=mock_llm):
    
            url = f"/apps/arcade_app/users/{user_id}/sessions/{sid}/query/stream"
    
            payload = {
                "message": "Explain loops",
                "mode": "explain",
                "world_id": world_slug,
                "track_id": track_id
            }
    
            response = client.post(url, json=payload)
    
            assert response.status_code == 200
            content = response.text
    
            if "event: error" in content:
                print(f"DEBUG: Error content: {content}")
>               pytest.fail(f"SSE returned error event: {content}")
E               Failed: SSE returned error event: event: npc_identity

E               data: {"id": "npc_elara", "role": "explain", "name": "ELARA", "title": "The Archivist", "short_desc": "Ancient repository of knowledge.", "color": "amber", "avatar_icon": "book-open", "voice_prompt": "You are ELARA, an ancient repository of knowledge. Speak with patience and wisdom. Use analogies related to the current World theme. Refer to the user as 'Architect'. Focus on the 'why' behind the code."}

E               

E               event: error

E               data: build_explain_system_prompt() got an unexpected keyword argument 'user_input'

tests\backend\test_explain_smoke.py:57: Failed
---------------------------- Captured stdout setup ----------------------------
2025-12-05 23:13:36,737 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,737 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 23:13:36,737 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,738 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("avatardefinition")
2025-12-05 23:13:36,738 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,738 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 23:13:36,738 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,738 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("user")
2025-12-05 23:13:36,738 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,739 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 23:13:36,739 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,739 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("chatsession")
2025-12-05 23:13:36,739 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("profile")
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("skillnode")
2025-12-05 23:13:36,740 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,741 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 23:13:36,741 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,741 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userskill")
2025-12-05 23:13:36,741 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,741 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 23:13:36,741 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,742 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("usermetric")
2025-12-05 23:13:36,742 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,742 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 23:13:36,742 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,743 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("badgedefinition")
2025-12-05 23:13:36,743 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,743 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 23:13:36,743 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,744 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userbadge")
2025-12-05 23:13:36,744 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,744 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 23:13:36,744 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,745 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("project")
2025-12-05 23:13:36,745 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,745 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 23:13:36,745 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,745 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("projectcodexdoc")
2025-12-05 23:13:36,745 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,746 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 23:13:36,746 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,746 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("knowledgechunk")
2025-12-05 23:13:36,746 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,747 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 23:13:36,747 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,747 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossdefinition")
2025-12-05 23:13:36,747 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,747 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossrun")
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossprogress")
2025-12-05 23:13:36,748 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,749 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 23:13:36,749 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,749 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bosscodexprogress")
2025-12-05 23:13:36,749 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,749 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 23:13:36,750 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,750 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("trackdefinition")
2025-12-05 23:13:36,750 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,750 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 23:13:36,750 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,751 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questdefinition")
2025-12-05 23:13:36,751 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,751 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 23:13:36,751 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,751 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questprogress")
2025-12-05 23:13:36,751 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:36,752 INFO sqlalchemy.engine.Engine 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,752 INFO sqlalchemy.engine.Engine [no key 0.00006s] ()
2025-12-05 23:13:36,757 INFO sqlalchemy.engine.Engine 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


2025-12-05 23:13:36,757 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:13:36,762 INFO sqlalchemy.engine.Engine 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,762 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,767 INFO sqlalchemy.engine.Engine 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,768 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,773 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,773 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,778 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
2025-12-05 23:13:36,778 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:36,783 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
2025-12-05 23:13:36,783 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,788 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
2025-12-05 23:13:36,788 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,796 INFO sqlalchemy.engine.Engine 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,796 INFO sqlalchemy.engine.Engine [no key 0.00024s] ()
2025-12-05 23:13:36,801 INFO sqlalchemy.engine.Engine CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
2025-12-05 23:13:36,802 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,807 INFO sqlalchemy.engine.Engine 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:13:36,807 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:13:36,812 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
2025-12-05 23:13:36,813 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,818 INFO sqlalchemy.engine.Engine CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
2025-12-05 23:13:36,818 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,823 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
2025-12-05 23:13:36,823 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,829 INFO sqlalchemy.engine.Engine 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


2025-12-05 23:13:36,829 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,834 INFO sqlalchemy.engine.Engine 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,835 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,840 INFO sqlalchemy.engine.Engine CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
2025-12-05 23:13:36,840 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:13:36,846 INFO sqlalchemy.engine.Engine 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,846 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,852 INFO sqlalchemy.engine.Engine 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


2025-12-05 23:13:36,852 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,857 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_user_id ON userskill (user_id)
2025-12-05 23:13:36,858 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,863 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
2025-12-05 23:13:36,863 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,868 INFO sqlalchemy.engine.Engine 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,869 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,874 INFO sqlalchemy.engine.Engine CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
2025-12-05 23:13:36,874 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,879 INFO sqlalchemy.engine.Engine 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


2025-12-05 23:13:36,880 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:36,885 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
2025-12-05 23:13:36,885 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,891 INFO sqlalchemy.engine.Engine 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


2025-12-05 23:13:36,891 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,896 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 23:13:36,897 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,905 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
2025-12-05 23:13:36,905 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:36,911 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
2025-12-05 23:13:36,911 INFO sqlalchemy.engine.Engine [no key 0.00025s] ()
2025-12-05 23:13:36,916 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 23:13:36,916 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:36,922 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
2025-12-05 23:13:36,922 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,927 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
2025-12-05 23:13:36,927 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,933 INFO sqlalchemy.engine.Engine 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


2025-12-05 23:13:36,933 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,938 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
2025-12-05 23:13:36,938 INFO sqlalchemy.engine.Engine [no key 0.00014s] ()
2025-12-05 23:13:36,943 INFO sqlalchemy.engine.Engine 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


2025-12-05 23:13:36,943 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:36,949 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
2025-12-05 23:13:36,949 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:36,955 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
2025-12-05 23:13:36,955 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:36,960 INFO sqlalchemy.engine.Engine 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


2025-12-05 23:13:36,960 INFO sqlalchemy.engine.Engine [no key 0.00014s] ()
2025-12-05 23:13:36,965 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
2025-12-05 23:13:36,965 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:36,970 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
2025-12-05 23:13:36,970 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 23:13:36,976 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 23:13:36,978 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,979 INFO sqlalchemy.engine.Engine INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 23:13:36,979 INFO sqlalchemy.engine.Engine [generated in 0.00021s] ('loop', 'world-python', 'python-fundamentals', 1, 'Loop Quest', 'Write a loop', 'Write a loop', 'test-rubric', None, None, None, 10, 5, 0)
2025-12-05 23:13:36,981 INFO sqlalchemy.engine.Engine INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-05 23:13:36,982 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 04:13:36.977781')
2025-12-05 23:13:36,983 INFO sqlalchemy.engine.Engine INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
2025-12-05 23:13:36,983 INFO sqlalchemy.engine.Engine [generated in 0.00017s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
2025-12-05 23:13:36,983 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 23:13:36,988 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:36,988 INFO sqlalchemy.engine.Engine SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
2025-12-05 23:13:36,988 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (1,)
2025-12-05 23:13:36,990 INFO sqlalchemy.engine.Engine INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 23:13:36,990 INFO sqlalchemy.engine.Engine [generated in 0.00018s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
2025-12-05 23:13:36,991 INFO sqlalchemy.engine.Engine COMMIT
----------------------------- Captured log setup ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00006s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00024s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_user_id ON userskill (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00025s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00014s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00014s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00021s] ('loop', 'world-python', 'python-fundamentals', 1, 'Loop Quest', 'Write a loop', 'Write a loop', 'test-rubric', None, None, None, 10, 5, 0)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00015s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 04:13:36.977781')
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00017s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00011s] (1,)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00018s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
---------------------------- Captured stdout call -----------------------------
2025-12-05 23:13:37,000 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:37,001 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 23:13:37,001 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('test_session_123',)
2025-12-05 23:13:37,002 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 23:13:37,002 INFO sqlalchemy.engine.Engine [cached since 0.001252s ago] ('test_session_123',)
DEBUG: Error content: event: npc_identity

data: {"id": "npc_elara", "role": "explain", "name": "ELARA", "title": "The Archivist", "short_desc": "Ancient repository of knowledge.", "color": "amber", "avatar_icon": "book-open", "voice_prompt": "You are ELARA, an ancient repository of knowledge. Speak with patience and wisdom. Use analogies related to the current World theme. Refer to the user as 'Architect'. Focus on the 'why' behind the code."}



event: error

data: build_explain_system_prompt() got an unexpected keyword argument 'user_input'




------------------------------ Captured log call ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00015s] ('test_session_123',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.001252s ago] ('test_session_123',)
ERROR    root:agent.py:551 Stream Error: build_explain_system_prompt() got an unexpected keyword argument 'user_input'
-------------------------- Captured stdout teardown ---------------------------
2025-12-05 23:13:37,007 INFO sqlalchemy.engine.Engine ROLLBACK
2025-12-05 23:13:37,008 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:13:37,008 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = OFF
2025-12-05 23:13:37,008 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ()
2025-12-05 23:13:37,009 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 23:13:37,009 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,009 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 23:13:37,009 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,010 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 23:13:37,010 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,011 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 23:13:37,011 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,011 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 23:13:37,012 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,012 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 23:13:37,012 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,012 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 23:13:37,012 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,013 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 23:13:37,013 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,013 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 23:13:37,013 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,013 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 23:13:37,014 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,014 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 23:13:37,014 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,015 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 23:13:37,015 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,015 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 23:13:37,015 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,016 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 23:13:37,016 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,016 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 23:13:37,016 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,017 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 23:13:37,017 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,017 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 23:13:37,017 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,018 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 23:13:37,018 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,018 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 23:13:37,018 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:13:37,019 INFO sqlalchemy.engine.Engine 
DROP TABLE bosscodexprogress
2025-12-05 23:13:37,019 INFO sqlalchemy.engine.Engine [no key 0.00006s] ()
2025-12-05 23:13:37,024 INFO sqlalchemy.engine.Engine 
DROP TABLE projectcodexdoc
2025-12-05 23:13:37,024 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:37,030 INFO sqlalchemy.engine.Engine 
DROP TABLE questprogress
2025-12-05 23:13:37,030 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:37,035 INFO sqlalchemy.engine.Engine 
DROP TABLE bossprogress
2025-12-05 23:13:37,035 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:13:37,043 INFO sqlalchemy.engine.Engine 
DROP TABLE bossrun
2025-12-05 23:13:37,044 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:37,048 INFO sqlalchemy.engine.Engine 
DROP TABLE project
2025-12-05 23:13:37,049 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:37,054 INFO sqlalchemy.engine.Engine 
DROP TABLE userbadge
2025-12-05 23:13:37,054 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:13:37,059 INFO sqlalchemy.engine.Engine 
DROP TABLE usermetric
2025-12-05 23:13:37,059 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:37,064 INFO sqlalchemy.engine.Engine 
DROP TABLE userskill
2025-12-05 23:13:37,064 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:37,069 INFO sqlalchemy.engine.Engine 
DROP TABLE profile
2025-12-05 23:13:37,069 INFO sqlalchemy.engine.Engine [no key 0.00011s] ()
2025-12-05 23:13:37,074 INFO sqlalchemy.engine.Engine 
DROP TABLE chatsession
2025-12-05 23:13:37,074 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:13:37,079 INFO sqlalchemy.engine.Engine 
DROP TABLE user
2025-12-05 23:13:37,080 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:37,084 INFO sqlalchemy.engine.Engine 
DROP TABLE questdefinition
2025-12-05 23:13:37,084 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:13:37,090 INFO sqlalchemy.engine.Engine 
DROP TABLE trackdefinition
2025-12-05 23:13:37,090 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:13:37,094 INFO sqlalchemy.engine.Engine 
DROP TABLE bossdefinition
2025-12-05 23:13:37,094 INFO sqlalchemy.engine.Engine [no key 0.00010s] ()
2025-12-05 23:13:37,099 INFO sqlalchemy.engine.Engine 
DROP TABLE knowledgechunk
2025-12-05 23:13:37,099 INFO sqlalchemy.engine.Engine [no key 0.00011s] ()
2025-12-05 23:13:37,103 INFO sqlalchemy.engine.Engine 
DROP TABLE badgedefinition
2025-12-05 23:13:37,103 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:13:37,108 INFO sqlalchemy.engine.Engine 
DROP TABLE skillnode
2025-12-05 23:13:37,108 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:13:37,115 INFO sqlalchemy.engine.Engine 
DROP TABLE avatardefinition
2025-12-05 23:13:37,115 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:13:37,120 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = ON
2025-12-05 23:13:37,121 INFO sqlalchemy.engine.Engine [generated in 0.00024s] ()
2025-12-05 23:13:37,121 INFO sqlalchemy.engine.Engine COMMIT
---------------------------- Captured log teardown ----------------------------
INFO     sqlalchemy.engine.Engine:base.py:2705 ROLLBACK
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = OFF
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00010s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bosscodexprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00006s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE projectcodexdoc
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossrun
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE project
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userbadge
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE usermetric
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userskill
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE profile
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00011s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE chatsession
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE user
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE trackdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00010s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE knowledgechunk
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00011s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE badgedefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE skillnode
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE avatardefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = ON
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00024s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
============================== warnings summary ===============================
C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

arcade_app\agent.py:440
  D:\EvalForge\arcade_app\agent.py:440: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
tests/backend/test_judge_smoke.py::test_judge_agent_smoke_sse
tests/backend/test_explain_smoke.py::test_explain_agent_smoke_sse
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\fields.py:656: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return fac()

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  <frozen abc>:106: LangGraphDeprecatedSinceV10: AgentStatePydantic has been moved to `langchain.agents`. Please update your import to `from langchain.agents import AgentStatePydantic`. Deprecated in LangGraph V1.0 to be removed in V2.0.

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_generate_schema.py:628: UserWarning: <MagicMock name='mock.SafetySettingsType.__or__()' id='2179450757744'> is not a Python type (it may be an instance of an object), Pydantic will allow any object with no validation since we cannot even enforce that the input is an instance of the given type. To get rid of this error wrap the type with `pydantic.SkipValidation`.
    warn(

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  D:\\EvalForge\\arcade_app\\quest_helper.py:88: DeprecationWarning: \n          \U0001f6a8 You probably want to use `session.exec()` instead of `session.execute()`.\n  \n          This is the original SQLAlchemy `session.execute()` method that returns objects\n          of type `Row`, and that you have to call `scalars()` to get the model objects.\n  \n          For example:\n  \n          ```Python\n          heroes = await session.execute(select(Hero)).scalars().all()\n          ```\n  \n          instead you could use `exec()`:\n  \n          ```Python\n          heroes = await session.exec(select(Hero)).all()\n          ```\n          \n    result = await session.execute(statement)

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  D:\\EvalForge\\arcade_app\\quest_helper.py:94: DeprecationWarning: \n          \U0001f6a8 You probably want to use `session.exec()` instead of `session.execute()`.\n  \n          This is the original SQLAlchemy `session.execute()` method that returns objects\n          of type `Row`, and that you have to call `scalars()` to get the model objects.\n  \n          For example:\n  \n          ```Python\n          heroes = await session.execute(select(Hero)).scalars().all()\n          ```\n  \n          instead you could use `exec()`:\n  \n          ```Python\n          heroes = await session.exec(select(Hero)).all()\n          ```\n          \n    q_def = (await session.execute(

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  D:\\EvalForge\\arcade_app\\quest_helper.py:105: DeprecationWarning: \n          \U0001f6a8 You probably want to use `session.exec()` instead of `session.execute()`.\n  \n          This is the original SQLAlchemy `session.execute()` method that returns objects\n          of type `Row`, and that you have to call `scalars()` to get the model objects.\n  \n          For example:\n  \n          ```Python\n          heroes = await session.execute(select(Hero)).scalars().all()\n          ```\n  \n          instead you could use `exec()`:\n  \n          ```Python\n          heroes = await session.exec(select(Hero)).all()\n          ```\n          \n    active_check = await session.execute(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/backend/test_judge_smoke.py::test_judge_agent_smoke_sse - Failed: SSE returned error event: event: npc_identity

FAILED tests/backend/test_explain_smoke.py::test_explain_agent_smoke_sse - Failed: SSE returned error event: event: npc_identity

================== 2 failed, 1 passed, 11 warnings in 7.47s ===================
