============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\EvalForge
plugins: anyio-4.11.0, Faker-37.11.0, langsmith-0.4.38, asyncio-1.2.0, cov-7.0.0, env-1.2.0, httpx-0.35.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 1 item

tests\backend\test_explain_smoke.py F                                    [100%]

================================== FAILURES ===================================
________________________ test_explain_agent_smoke_sse _________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x000002297DC34C20>
mock_vertex_ai_modules = <MagicMock id='2377224941120'>
patch_tracks_for_explain = None
explain_smoke_session = ('smoke_test_user', 'test_session_123')

    async def test_explain_agent_smoke_sse(
        db_session,
        mock_vertex_ai_modules,
        patch_tracks_for_explain,
        explain_smoke_session
    ):
        """
        Smoke test for Explain Agent.
        """
        user_id, sid = explain_smoke_session
        world_slug = "world-python"
        track_id = "python-fundamentals"
    
        client = TestClient(app)
    
        async def mock_get_session():
            yield db_session
    
        # Mock get_chat_model to avoid Real Vertex connection or ImportErrors from langchain_google_vertexai
        mock_llm = AsyncMock()
    
        async def mock_astream(messages):
            chunk = AsyncMock()
            chunk.content = "Hello from Smoke Test Agent"
            yield chunk
    
        mock_llm.astream.side_effect = mock_astream
    
        with patch("arcade_app.quest_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.session_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.explain_agent.get_session", side_effect=mock_get_session), \
             patch("arcade_app.llm.get_chat_model", return_value=mock_llm):
    
            url = f"/apps/arcade_app/users/{user_id}/sessions/{sid}/query/stream"
    
            payload = {
                "message": "Explain loops",
                "mode": "explain",
                "world_id": world_slug,
                "track_id": track_id
            }
    
            response = client.post(url, json=payload)
    
            assert response.status_code == 200
            content = response.text
    
            if "event: error" in content:
                print(f"DEBUG: Error content: {content}")
>               pytest.fail(f"SSE returned error event: {content}")
E               Failed: SSE returned error event: event: npc_identity

E               data: {"id": "npc_elara", "role": "explain", "name": "ELARA", "title": "The Archivist", "short_desc": "Ancient repository of knowledge.", "color": "amber", "avatar_icon": "book-open", "voice_prompt": "You are ELARA, an ancient repository of knowledge. Speak with patience and wisdom. Use analogies related to the current World theme. Refer to the user as 'Architect'. Focus on the 'why' behind the code."}

E               

E               event: error

E               data: build_explain_system_prompt() got an unexpected keyword argument 'user_input'

tests\backend\test_explain_smoke.py:57: Failed
---------------------------- Captured stdout setup ----------------------------
2025-12-05 23:29:27,516 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:29:27,516 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 23:29:27,516 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,518 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("avatardefinition")
2025-12-05 23:29:27,518 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,519 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 23:29:27,519 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,519 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("user")
2025-12-05 23:29:27,520 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,520 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 23:29:27,520 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,520 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("chatsession")
2025-12-05 23:29:27,520 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,521 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 23:29:27,521 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,522 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("profile")
2025-12-05 23:29:27,522 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,522 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 23:29:27,522 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,523 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("skillnode")
2025-12-05 23:29:27,523 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,523 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 23:29:27,523 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,523 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userskill")
2025-12-05 23:29:27,524 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,524 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 23:29:27,524 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,524 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("usermetric")
2025-12-05 23:29:27,525 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,525 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 23:29:27,525 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,526 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("badgedefinition")
2025-12-05 23:29:27,526 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,526 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 23:29:27,526 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,526 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userbadge")
2025-12-05 23:29:27,526 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,527 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 23:29:27,527 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,527 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("project")
2025-12-05 23:29:27,527 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,528 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 23:29:27,528 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,528 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("projectcodexdoc")
2025-12-05 23:29:27,528 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,529 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 23:29:27,529 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,530 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("knowledgechunk")
2025-12-05 23:29:27,530 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,530 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 23:29:27,530 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,531 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossdefinition")
2025-12-05 23:29:27,531 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,532 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 23:29:27,532 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,532 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossrun")
2025-12-05 23:29:27,533 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,533 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 23:29:27,533 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,534 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossprogress")
2025-12-05 23:29:27,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,534 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 23:29:27,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,534 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bosscodexprogress")
2025-12-05 23:29:27,534 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,535 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 23:29:27,535 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,536 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("trackdefinition")
2025-12-05 23:29:27,536 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,536 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 23:29:27,536 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,537 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questdefinition")
2025-12-05 23:29:27,537 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,538 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 23:29:27,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,538 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questprogress")
2025-12-05 23:29:27,538 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:27,539 INFO sqlalchemy.engine.Engine 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:29:27,539 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,569 INFO sqlalchemy.engine.Engine 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


2025-12-05 23:29:27,569 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:29:27,583 INFO sqlalchemy.engine.Engine 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:29:27,583 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,591 INFO sqlalchemy.engine.Engine 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


2025-12-05 23:29:27,591 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:29:27,603 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:29:27,604 INFO sqlalchemy.engine.Engine [no key 0.00032s] ()
2025-12-05 23:29:27,612 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
2025-12-05 23:29:27,612 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,619 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
2025-12-05 23:29:27,620 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 23:29:27,627 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
2025-12-05 23:29:27,627 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:29:27,635 INFO sqlalchemy.engine.Engine 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


2025-12-05 23:29:27,636 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:27,644 INFO sqlalchemy.engine.Engine CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
2025-12-05 23:29:27,644 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:29:27,652 INFO sqlalchemy.engine.Engine 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 23:29:27,652 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:29:27,660 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
2025-12-05 23:29:27,661 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:27,668 INFO sqlalchemy.engine.Engine CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
2025-12-05 23:29:27,669 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 23:29:27,679 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
2025-12-05 23:29:27,680 INFO sqlalchemy.engine.Engine [no key 0.00024s] ()
2025-12-05 23:29:27,688 INFO sqlalchemy.engine.Engine 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


2025-12-05 23:29:27,688 INFO sqlalchemy.engine.Engine [no key 0.00025s] ()
2025-12-05 23:29:27,696 INFO sqlalchemy.engine.Engine 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:29:27,696 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:27,705 INFO sqlalchemy.engine.Engine CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
2025-12-05 23:29:27,705 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:27,714 INFO sqlalchemy.engine.Engine 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:29:27,714 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:27,723 INFO sqlalchemy.engine.Engine 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


2025-12-05 23:29:27,723 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:27,731 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_user_id ON userskill (user_id)
2025-12-05 23:29:27,731 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:27,740 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
2025-12-05 23:29:27,740 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,749 INFO sqlalchemy.engine.Engine 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 23:29:27,749 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:27,758 INFO sqlalchemy.engine.Engine CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
2025-12-05 23:29:27,758 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:29:27,766 INFO sqlalchemy.engine.Engine 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


2025-12-05 23:29:27,766 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,775 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
2025-12-05 23:29:27,775 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:29:27,783 INFO sqlalchemy.engine.Engine 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


2025-12-05 23:29:27,783 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,791 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 23:29:27,792 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,800 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
2025-12-05 23:29:27,800 INFO sqlalchemy.engine.Engine [no key 0.00029s] ()
2025-12-05 23:29:27,809 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
2025-12-05 23:29:27,809 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:29:27,817 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 23:29:27,817 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:29:27,826 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
2025-12-05 23:29:27,826 INFO sqlalchemy.engine.Engine [no key 0.00029s] ()
2025-12-05 23:29:27,838 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
2025-12-05 23:29:27,839 INFO sqlalchemy.engine.Engine [no key 0.00025s] ()
2025-12-05 23:29:27,847 INFO sqlalchemy.engine.Engine 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


2025-12-05 23:29:27,847 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:27,856 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
2025-12-05 23:29:27,856 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:29:27,863 INFO sqlalchemy.engine.Engine 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


2025-12-05 23:29:27,864 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:29:27,872 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
2025-12-05 23:29:27,872 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:27,881 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
2025-12-05 23:29:27,881 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:27,889 INFO sqlalchemy.engine.Engine 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


2025-12-05 23:29:27,889 INFO sqlalchemy.engine.Engine [no key 0.00028s] ()
2025-12-05 23:29:27,897 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
2025-12-05 23:29:27,897 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:27,905 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
2025-12-05 23:29:27,905 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:29:27,913 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 23:29:27,935 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:29:27,936 INFO sqlalchemy.engine.Engine INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 23:29:27,936 INFO sqlalchemy.engine.Engine [generated in 0.00039s] ('loop', 'world-python', 'python-fundamentals', 1, 'Loop Quest', 'Write a loop', 'Write a loop', 'test-rubric', None, None, None, 10, 5, 0)
2025-12-05 23:29:27,941 INFO sqlalchemy.engine.Engine INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-05 23:29:27,941 INFO sqlalchemy.engine.Engine [generated in 0.00059s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 04:29:27.934211')
2025-12-05 23:29:27,943 INFO sqlalchemy.engine.Engine INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
2025-12-05 23:29:27,943 INFO sqlalchemy.engine.Engine [generated in 0.00026s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
2025-12-05 23:29:27,944 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 23:29:27,957 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:29:27,960 INFO sqlalchemy.engine.Engine SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
2025-12-05 23:29:27,960 INFO sqlalchemy.engine.Engine [generated in 0.00046s] (1,)
2025-12-05 23:29:27,963 INFO sqlalchemy.engine.Engine INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 23:29:27,963 INFO sqlalchemy.engine.Engine [generated in 0.00023s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
2025-12-05 23:29:27,965 INFO sqlalchemy.engine.Engine COMMIT
----------------------------- Captured log setup ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00032s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00024s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00025s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_user_id ON userskill (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00029s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00029s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00025s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00028s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00039s] ('loop', 'world-python', 'python-fundamentals', 1, 'Loop Quest', 'Write a loop', 'Write a loop', 'test-rubric', None, None, None, 10, 5, 0)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00059s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 04:29:27.934211')
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00026s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00046s] (1,)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00023s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
---------------------------- Captured stdout call -----------------------------
2025-12-05 23:29:33,973 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:29:33,975 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 23:29:33,975 INFO sqlalchemy.engine.Engine [generated in 0.00022s] ('test_session_123',)
2025-12-05 23:29:33,976 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 23:29:33,976 INFO sqlalchemy.engine.Engine [cached since 0.001432s ago] ('test_session_123',)
DEBUG: Error content: event: npc_identity

data: {"id": "npc_elara", "role": "explain", "name": "ELARA", "title": "The Archivist", "short_desc": "Ancient repository of knowledge.", "color": "amber", "avatar_icon": "book-open", "voice_prompt": "You are ELARA, an ancient repository of knowledge. Speak with patience and wisdom. Use analogies related to the current World theme. Refer to the user as 'Architect'. Focus on the 'why' behind the code."}



event: error

data: build_explain_system_prompt() got an unexpected keyword argument 'user_input'




------------------------------ Captured log call ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00022s] ('test_session_123',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.001432s ago] ('test_session_123',)
ERROR    root:agent.py:551 Stream Error: build_explain_system_prompt() got an unexpected keyword argument 'user_input'
-------------------------- Captured stdout teardown ---------------------------
2025-12-05 23:29:33,983 INFO sqlalchemy.engine.Engine ROLLBACK
2025-12-05 23:29:33,984 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 23:29:33,985 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = OFF
2025-12-05 23:29:33,985 INFO sqlalchemy.engine.Engine [generated in 0.00014s] ()
2025-12-05 23:29:33,986 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 23:29:33,986 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,987 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 23:29:33,987 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,987 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 23:29:33,987 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,988 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 23:29:33,988 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,988 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 23:29:33,988 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,989 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 23:29:33,989 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,989 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 23:29:33,989 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,990 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 23:29:33,990 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,990 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 23:29:33,990 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,991 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 23:29:33,991 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,991 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 23:29:33,991 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,992 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 23:29:33,992 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,992 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 23:29:33,992 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,993 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 23:29:33,993 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,993 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 23:29:33,993 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,994 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 23:29:33,994 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,994 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 23:29:33,994 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,995 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 23:29:33,995 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,995 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 23:29:33,995 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 23:29:33,996 INFO sqlalchemy.engine.Engine 
DROP TABLE bosscodexprogress
2025-12-05 23:29:33,996 INFO sqlalchemy.engine.Engine [no key 0.00010s] ()
2025-12-05 23:29:34,057 INFO sqlalchemy.engine.Engine 
DROP TABLE projectcodexdoc
2025-12-05 23:29:34,057 INFO sqlalchemy.engine.Engine [no key 0.00025s] ()
2025-12-05 23:29:34,070 INFO sqlalchemy.engine.Engine 
DROP TABLE questprogress
2025-12-05 23:29:34,070 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:29:34,078 INFO sqlalchemy.engine.Engine 
DROP TABLE bossprogress
2025-12-05 23:29:34,078 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:29:34,086 INFO sqlalchemy.engine.Engine 
DROP TABLE bossrun
2025-12-05 23:29:34,087 INFO sqlalchemy.engine.Engine [no key 0.00029s] ()
2025-12-05 23:29:34,094 INFO sqlalchemy.engine.Engine 
DROP TABLE project
2025-12-05 23:29:34,095 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:34,103 INFO sqlalchemy.engine.Engine 
DROP TABLE userbadge
2025-12-05 23:29:34,103 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 23:29:34,112 INFO sqlalchemy.engine.Engine 
DROP TABLE usermetric
2025-12-05 23:29:34,112 INFO sqlalchemy.engine.Engine [no key 0.00035s] ()
2025-12-05 23:29:34,121 INFO sqlalchemy.engine.Engine 
DROP TABLE userskill
2025-12-05 23:29:34,121 INFO sqlalchemy.engine.Engine [no key 0.00026s] ()
2025-12-05 23:29:34,132 INFO sqlalchemy.engine.Engine 
DROP TABLE profile
2025-12-05 23:29:34,132 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 23:29:34,140 INFO sqlalchemy.engine.Engine 
DROP TABLE chatsession
2025-12-05 23:29:34,140 INFO sqlalchemy.engine.Engine [no key 0.00034s] ()
2025-12-05 23:29:34,148 INFO sqlalchemy.engine.Engine 
DROP TABLE user
2025-12-05 23:29:34,149 INFO sqlalchemy.engine.Engine [no key 0.00033s] ()
2025-12-05 23:29:34,156 INFO sqlalchemy.engine.Engine 
DROP TABLE questdefinition
2025-12-05 23:29:34,157 INFO sqlalchemy.engine.Engine [no key 0.00025s] ()
2025-12-05 23:29:34,164 INFO sqlalchemy.engine.Engine 
DROP TABLE trackdefinition
2025-12-05 23:29:34,164 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:29:34,172 INFO sqlalchemy.engine.Engine 
DROP TABLE bossdefinition
2025-12-05 23:29:34,172 INFO sqlalchemy.engine.Engine [no key 0.00032s] ()
2025-12-05 23:29:34,180 INFO sqlalchemy.engine.Engine 
DROP TABLE knowledgechunk
2025-12-05 23:29:34,180 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 23:29:34,187 INFO sqlalchemy.engine.Engine 
DROP TABLE badgedefinition
2025-12-05 23:29:34,187 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 23:29:34,194 INFO sqlalchemy.engine.Engine 
DROP TABLE skillnode
2025-12-05 23:29:34,194 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 23:29:34,201 INFO sqlalchemy.engine.Engine 
DROP TABLE avatardefinition
2025-12-05 23:29:34,202 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 23:29:34,209 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = ON
2025-12-05 23:29:34,209 INFO sqlalchemy.engine.Engine [generated in 0.00022s] ()
2025-12-05 23:29:34,209 INFO sqlalchemy.engine.Engine COMMIT
---------------------------- Captured log teardown ----------------------------
INFO     sqlalchemy.engine.Engine:base.py:2705 ROLLBACK
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = OFF
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00014s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bosscodexprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00010s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE projectcodexdoc
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00025s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossrun
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00029s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE project
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userbadge
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE usermetric
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00035s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userskill
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00026s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE profile
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE chatsession
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00034s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE user
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00033s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00025s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE trackdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00032s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE knowledgechunk
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE badgedefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE skillnode
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE avatardefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = ON
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
============================== warnings summary ===============================
C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

arcade_app\agent.py:440
  D:\EvalForge\arcade_app\agent.py:440: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/backend/test_explain_smoke.py::test_explain_agent_smoke_sse
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\fields.py:656: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return fac()

tests/backend/test_explain_smoke.py::test_explain_agent_smoke_sse
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_generate_schema.py:628: UserWarning: <MagicMock name='mock.SafetySettingsType.__or__()' id='2375432834752'> is not a Python type (it may be an instance of an object), Pydantic will allow any object with no validation since we cannot even enforce that the input is an instance of the given type. To get rid of this error wrap the type with `pydantic.SkipValidation`.
    warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/backend/test_explain_smoke.py::test_explain_agent_smoke_sse - Failed: SSE returned error event: event: npc_identity

======================== 1 failed, 5 warnings in 7.48s ========================
