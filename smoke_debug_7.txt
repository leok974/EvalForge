============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\EvalForge
plugins: anyio-4.11.0, Faker-37.11.0, langsmith-0.4.38, asyncio-1.2.0, cov-7.0.0, env-1.2.0, httpx-0.35.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 1 item

tests\backend\test_quest_smoke.py 2025-12-05 22:44:24,940 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 22:44:24,940 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 22:44:24,940 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,941 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("avatardefinition")
2025-12-05 22:44:24,942 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,942 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 22:44:24,943 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,943 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("user")
2025-12-05 22:44:24,943 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,943 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 22:44:24,944 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,944 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("chatsession")
2025-12-05 22:44:24,944 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,944 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 22:44:24,944 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,945 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("profile")
2025-12-05 22:44:24,945 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,945 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 22:44:24,945 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,946 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("skillnode")
2025-12-05 22:44:24,946 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,946 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 22:44:24,946 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,946 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userskill")
2025-12-05 22:44:24,946 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,947 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 22:44:24,947 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,947 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("usermetric")
2025-12-05 22:44:24,947 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,948 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 22:44:24,948 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,948 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("badgedefinition")
2025-12-05 22:44:24,948 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,949 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 22:44:24,949 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,949 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("userbadge")
2025-12-05 22:44:24,949 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,949 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 22:44:24,949 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,950 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("project")
2025-12-05 22:44:24,950 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,950 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 22:44:24,950 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,951 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("projectcodexdoc")
2025-12-05 22:44:24,951 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,951 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 22:44:24,951 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,951 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("knowledgechunk")
2025-12-05 22:44:24,952 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,952 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 22:44:24,952 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,952 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossdefinition")
2025-12-05 22:44:24,953 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,953 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 22:44:24,953 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,953 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossrun")
2025-12-05 22:44:24,953 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,954 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 22:44:24,954 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,954 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bossprogress")
2025-12-05 22:44:24,954 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,955 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 22:44:24,955 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,955 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("bosscodexprogress")
2025-12-05 22:44:24,955 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,955 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 22:44:24,956 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,956 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("trackdefinition")
2025-12-05 22:44:24,956 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,956 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 22:44:24,956 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,957 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questdefinition")
2025-12-05 22:44:24,957 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,957 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 22:44:24,957 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,958 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("questprogress")
2025-12-05 22:44:24,958 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:24,959 INFO sqlalchemy.engine.Engine 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 22:44:24,959 INFO sqlalchemy.engine.Engine [no key 0.00010s] ()
2025-12-05 22:44:24,977 INFO sqlalchemy.engine.Engine 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


2025-12-05 22:44:24,977 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:24,987 INFO sqlalchemy.engine.Engine 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 22:44:24,987 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 22:44:24,996 INFO sqlalchemy.engine.Engine 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


2025-12-05 22:44:24,996 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 22:44:25,004 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 22:44:25,004 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 22:44:25,012 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
2025-12-05 22:44:25,012 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,020 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
2025-12-05 22:44:25,020 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 22:44:25,028 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
2025-12-05 22:44:25,028 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:25,037 INFO sqlalchemy.engine.Engine 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


2025-12-05 22:44:25,037 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:25,045 INFO sqlalchemy.engine.Engine CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
2025-12-05 22:44:25,046 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:25,054 INFO sqlalchemy.engine.Engine 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


2025-12-05 22:44:25,054 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,062 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
2025-12-05 22:44:25,062 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:25,070 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
2025-12-05 22:44:25,070 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,078 INFO sqlalchemy.engine.Engine CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
2025-12-05 22:44:25,078 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:25,086 INFO sqlalchemy.engine.Engine 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


2025-12-05 22:44:25,086 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:25,097 INFO sqlalchemy.engine.Engine 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 22:44:25,098 INFO sqlalchemy.engine.Engine [no key 0.00023s] ()
2025-12-05 22:44:25,106 INFO sqlalchemy.engine.Engine CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
2025-12-05 22:44:25,106 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:25,115 INFO sqlalchemy.engine.Engine 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 22:44:25,115 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 22:44:25,123 INFO sqlalchemy.engine.Engine 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


2025-12-05 22:44:25,124 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,132 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_user_id ON userskill (user_id)
2025-12-05 22:44:25,132 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 22:44:25,140 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
2025-12-05 22:44:25,140 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:25,149 INFO sqlalchemy.engine.Engine 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


2025-12-05 22:44:25,149 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:25,157 INFO sqlalchemy.engine.Engine CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
2025-12-05 22:44:25,157 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:25,166 INFO sqlalchemy.engine.Engine 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


2025-12-05 22:44:25,166 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:25,175 INFO sqlalchemy.engine.Engine CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
2025-12-05 22:44:25,175 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 22:44:25,184 INFO sqlalchemy.engine.Engine 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


2025-12-05 22:44:25,184 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:25,193 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 22:44:25,193 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,201 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
2025-12-05 22:44:25,201 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 22:44:25,209 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
2025-12-05 22:44:25,209 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:25,218 INFO sqlalchemy.engine.Engine 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


2025-12-05 22:44:25,218 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,226 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
2025-12-05 22:44:25,227 INFO sqlalchemy.engine.Engine [no key 0.00048s] ()
2025-12-05 22:44:25,235 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
2025-12-05 22:44:25,235 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:25,244 INFO sqlalchemy.engine.Engine 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


2025-12-05 22:44:25,244 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 22:44:25,255 INFO sqlalchemy.engine.Engine CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
2025-12-05 22:44:25,255 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 22:44:25,263 INFO sqlalchemy.engine.Engine 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


2025-12-05 22:44:25,263 INFO sqlalchemy.engine.Engine [no key 0.00017s] ()
2025-12-05 22:44:25,271 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
2025-12-05 22:44:25,271 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:25,281 INFO sqlalchemy.engine.Engine CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
2025-12-05 22:44:25,281 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:25,290 INFO sqlalchemy.engine.Engine 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


2025-12-05 22:44:25,290 INFO sqlalchemy.engine.Engine [no key 0.00043s] ()
2025-12-05 22:44:25,298 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
2025-12-05 22:44:25,299 INFO sqlalchemy.engine.Engine [no key 0.00027s] ()
2025-12-05 22:44:25,307 INFO sqlalchemy.engine.Engine CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
2025-12-05 22:44:25,307 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:25,316 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 22:44:25,348 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 22:44:25,350 INFO sqlalchemy.engine.Engine INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 22:44:25,351 INFO sqlalchemy.engine.Engine [generated in 0.00033s] ('loop', 'world-python', 'python-fundamentals', 0, 'Loop Quest', 'Write a loop', None, None, None, None, None, 50, 25, 0)
2025-12-05 22:44:25,355 INFO sqlalchemy.engine.Engine INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-05 22:44:25,355 INFO sqlalchemy.engine.Engine [generated in 0.00030s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 03:44:25.347763')
2025-12-05 22:44:25,356 INFO sqlalchemy.engine.Engine INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
2025-12-05 22:44:25,356 INFO sqlalchemy.engine.Engine [generated in 0.00026s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
2025-12-05 22:44:25,357 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 22:44:25,365 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 22:44:25,367 INFO sqlalchemy.engine.Engine SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
2025-12-05 22:44:25,367 INFO sqlalchemy.engine.Engine [generated in 0.00023s] (1,)
2025-12-05 22:44:25,369 INFO sqlalchemy.engine.Engine INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
2025-12-05 22:44:25,370 INFO sqlalchemy.engine.Engine [generated in 0.00026s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
2025-12-05 22:44:25,371 INFO sqlalchemy.engine.Engine COMMIT
2025-12-05 22:44:25,390 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 22:44:25,392 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 22:44:25,392 INFO sqlalchemy.engine.Engine [generated in 0.00024s] ('test_session_123',)
2025-12-05 22:44:25,393 INFO sqlalchemy.engine.Engine SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
2025-12-05 22:44:25,394 INFO sqlalchemy.engine.Engine [cached since 0.001966s ago] ('test_session_123',)
Stream output:
event: error

data: No module named 'vertexai.generative_models._generative_models'; 'vertexai.generative_models' is not a package




F2025-12-05 22:44:29,401 INFO sqlalchemy.engine.Engine ROLLBACK
2025-12-05 22:44:29,402 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-12-05 22:44:29,403 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = OFF
2025-12-05 22:44:29,403 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ()
2025-12-05 22:44:29,403 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("avatardefinition")
2025-12-05 22:44:29,403 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,404 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user")
2025-12-05 22:44:29,404 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,405 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("chatsession")
2025-12-05 22:44:29,405 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,406 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("profile")
2025-12-05 22:44:29,406 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,406 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("skillnode")
2025-12-05 22:44:29,406 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,407 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userskill")
2025-12-05 22:44:29,407 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,407 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("usermetric")
2025-12-05 22:44:29,407 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,408 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("badgedefinition")
2025-12-05 22:44:29,408 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,409 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("userbadge")
2025-12-05 22:44:29,409 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,410 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("project")
2025-12-05 22:44:29,410 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,410 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("projectcodexdoc")
2025-12-05 22:44:29,410 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,411 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("knowledgechunk")
2025-12-05 22:44:29,411 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,411 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossdefinition")
2025-12-05 22:44:29,411 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,412 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossrun")
2025-12-05 22:44:29,412 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,412 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bossprogress")
2025-12-05 22:44:29,412 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,413 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("bosscodexprogress")
2025-12-05 22:44:29,413 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,413 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("trackdefinition")
2025-12-05 22:44:29,413 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,414 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questdefinition")
2025-12-05 22:44:29,414 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,414 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("questprogress")
2025-12-05 22:44:29,414 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-12-05 22:44:29,415 INFO sqlalchemy.engine.Engine 
DROP TABLE bosscodexprogress
2025-12-05 22:44:29,415 INFO sqlalchemy.engine.Engine [no key 0.00009s] ()
2025-12-05 22:44:29,446 INFO sqlalchemy.engine.Engine 
DROP TABLE projectcodexdoc
2025-12-05 22:44:29,446 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 22:44:29,455 INFO sqlalchemy.engine.Engine 
DROP TABLE questprogress
2025-12-05 22:44:29,455 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:29,463 INFO sqlalchemy.engine.Engine 
DROP TABLE bossprogress
2025-12-05 22:44:29,463 INFO sqlalchemy.engine.Engine [no key 0.00024s] ()
2025-12-05 22:44:29,471 INFO sqlalchemy.engine.Engine 
DROP TABLE bossrun
2025-12-05 22:44:29,471 INFO sqlalchemy.engine.Engine [no key 0.00021s] ()
2025-12-05 22:44:29,479 INFO sqlalchemy.engine.Engine 
DROP TABLE project
2025-12-05 22:44:29,479 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:29,487 INFO sqlalchemy.engine.Engine 
DROP TABLE userbadge
2025-12-05 22:44:29,487 INFO sqlalchemy.engine.Engine [no key 0.00020s] ()
2025-12-05 22:44:29,495 INFO sqlalchemy.engine.Engine 
DROP TABLE usermetric
2025-12-05 22:44:29,495 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 22:44:29,502 INFO sqlalchemy.engine.Engine 
DROP TABLE userskill
2025-12-05 22:44:29,503 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 22:44:29,510 INFO sqlalchemy.engine.Engine 
DROP TABLE profile
2025-12-05 22:44:29,510 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 22:44:29,518 INFO sqlalchemy.engine.Engine 
DROP TABLE chatsession
2025-12-05 22:44:29,518 INFO sqlalchemy.engine.Engine [no key 0.00022s] ()
2025-12-05 22:44:29,528 INFO sqlalchemy.engine.Engine 
DROP TABLE user
2025-12-05 22:44:29,529 INFO sqlalchemy.engine.Engine [no key 0.00019s] ()
2025-12-05 22:44:29,536 INFO sqlalchemy.engine.Engine 
DROP TABLE questdefinition
2025-12-05 22:44:29,536 INFO sqlalchemy.engine.Engine [no key 0.00018s] ()
2025-12-05 22:44:29,544 INFO sqlalchemy.engine.Engine 
DROP TABLE trackdefinition
2025-12-05 22:44:29,544 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 22:44:29,550 INFO sqlalchemy.engine.Engine 
DROP TABLE bossdefinition
2025-12-05 22:44:29,551 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()
2025-12-05 22:44:29,557 INFO sqlalchemy.engine.Engine 
DROP TABLE knowledgechunk
2025-12-05 22:44:29,557 INFO sqlalchemy.engine.Engine [no key 0.00011s] ()
2025-12-05 22:44:29,564 INFO sqlalchemy.engine.Engine 
DROP TABLE badgedefinition
2025-12-05 22:44:29,564 INFO sqlalchemy.engine.Engine [no key 0.00010s] ()
2025-12-05 22:44:29,571 INFO sqlalchemy.engine.Engine 
DROP TABLE skillnode
2025-12-05 22:44:29,572 INFO sqlalchemy.engine.Engine [no key 0.00014s] ()
2025-12-05 22:44:29,578 INFO sqlalchemy.engine.Engine 
DROP TABLE avatardefinition
2025-12-05 22:44:29,579 INFO sqlalchemy.engine.Engine [no key 0.00016s] ()
2025-12-05 22:44:29,586 INFO sqlalchemy.engine.Engine PRAGMA foreign_keys = ON
2025-12-05 22:44:29,586 INFO sqlalchemy.engine.Engine [generated in 0.00020s] ()
2025-12-05 22:44:29,587 INFO sqlalchemy.engine.Engine COMMIT


================================== FAILURES ===================================
_________________________ test_quest_agent_smoke_sse __________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x0000024DB90B1400>
mock_llm_response = <MagicMock id='2532840249664'>

    async def test_quest_agent_smoke_sse(db_session, mock_llm_response):
        """
        Smoke test: verify strict Quest Agent chat flow via SSE endpoint.
        Simulates:
        1. User asking 'Help me'.
        2. Agent (mocked LLM) responding 'Hello from Smoke Test Agent'.
        3. SSE stream delivering the text delta.
        """
        user_id = "smoke_test_user"
        world_slug = "world-python"
        track_id = "python-fundamentals" # From tracks.json
        quest_slug = "loop"
    
        # 1. Seed Database with User, Profile, and Active Quest
        user = User(id=user_id, name="Smoke Tester")
        db_session.add(user)
    
        profile = Profile(user_id=user_id, total_xp=0)
        db_session.add(profile)
    
        # We need a QuestDefinition for the agent to find context
        q1 = QuestDefinition(
            slug=quest_slug,
            world_id=world_slug,
            track_id=track_id,
            sequence_order=1,
            title="Loop Quest",
            short_description="Write a loop",
            technical_objective="Write a loop",
            rubric_hints="Check for..",
            xp_reward=10
        )
        db_session.add(q1)
        await db_session.commit()
        await db_session.refresh(q1)
    
        # Set it as active via QuestProgress
        qp = QuestProgress(
            user_id=user_id,
            quest_id=q1.id,  # Use the Integer PK
            state=QuestState.IN_PROGRESS,
            attempts=0
        )
        db_session.add(qp)
    
        await db_session.commit()
    
        # 2. Prepare Client & Request
        # We use TestClient(app) which triggers startup events (loading universe)
        client = TestClient(app)
    
        # Patch get_session used by endpoints to use our test db_session
        async def mock_get_session():
            yield db_session
    
        with patch("arcade_app.quest_helper.get_session", side_effect=mock_get_session), \
             patch("arcade_app.session_helper.get_session", side_effect=mock_get_session):
    
            # SSE Endpoint URL
            sid = "test_session_123"
            url = f"/apps/arcade_app/users/{user_id}/sessions/{sid}/query/stream"
    
            payload = {
                "message": "Start the quest",
                "mode": "quest",
                "world_id": world_slug,
                "track_id": track_id
            }
    
            # 3. Call Endpoint (Stream)
            # TestClient (httpx) will read format if we don't use .stream() context.
            # Since our mock finishes, this should return the full SSE body.
            response = client.post(url, json=payload)
    
            assert response.status_code == 200
    
            # 4. Consume Content
            content = response.text
    
            print(f"Stream output:\n{content}")
>           assert "event: text_delta" in content, "Expected 'text_delta' event in SSE stream"
E           AssertionError: Expected 'text_delta' event in SSE stream
E           assert 'event: text_delta' in "event: error\r\ndata: No module named 'vertexai.generative_models._generative_models'; 'vertexai.generative_models' is not a package\r\n\r\n"

tests\backend\test_quest_smoke.py:138: AssertionError
----------------------------- Captured log setup ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA temp.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE avatardefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	required_level INTEGER NOT NULL, 
	rarity VARCHAR NOT NULL, 
	visual_type VARCHAR NOT NULL, 
	visual_data VARCHAR NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00010s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE skillnode (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	tier INTEGER NOT NULL, 
	cost INTEGER NOT NULL, 
	category VARCHAR NOT NULL, 
	feature_key VARCHAR NOT NULL, 
	parent_id VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE badgedefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	icon_url VARCHAR, 
	xp_bonus INTEGER NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE knowledgechunk (
	id INTEGER NOT NULL, 
	source_type VARCHAR NOT NULL, 
	source_id VARCHAR NOT NULL, 
	chunk_index INTEGER NOT NULL, 
	metadata_json JSON NOT NULL, 
	content VARCHAR NOT NULL, 
	embedding VECTOR(768), 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossdefinition (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	rubric VARCHAR NOT NULL, 
	starting_code VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	project_slug VARCHAR, 
	tech_focus JSON NOT NULL, 
	phase VARCHAR, 
	time_limit_seconds INTEGER NOT NULL, 
	max_hp INTEGER NOT NULL, 
	base_xp_reward INTEGER NOT NULL, 
	difficulty VARCHAR NOT NULL, 
	hint_codex_id VARCHAR, 
	enabled BOOLEAN NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_project_slug ON bossdefinition (project_slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_world_id ON bossdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossdefinition_track_id ON bossdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE trackdefinition (
	id VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	description VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	boss_slug VARCHAR, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_trackdefinition_world_id ON trackdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questdefinition (
	id INTEGER NOT NULL, 
	slug VARCHAR NOT NULL, 
	world_id VARCHAR NOT NULL, 
	track_id VARCHAR NOT NULL, 
	order_index INTEGER NOT NULL, 
	title VARCHAR NOT NULL, 
	short_description VARCHAR NOT NULL, 
	detailed_description VARCHAR, 
	rubric_id VARCHAR, 
	starting_code_path VARCHAR, 
	unlocks_boss_id VARCHAR, 
	unlocks_layout_id VARCHAR, 
	base_xp_reward INTEGER NOT NULL, 
	mastery_xp_bonus INTEGER NOT NULL, 
	is_repeatable BOOLEAN NOT NULL, 
	PRIMARY KEY (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_track_id ON questdefinition (track_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questdefinition_world_id ON questdefinition (world_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE UNIQUE INDEX ix_questdefinition_slug ON questdefinition (slug)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE user (
	id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	avatar_url VARCHAR, 
	current_avatar_id VARCHAR NOT NULL, 
	created_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(current_avatar_id) REFERENCES avatardefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE chatsession (
	id VARCHAR NOT NULL, 
	user_id VARCHAR NOT NULL, 
	mode VARCHAR NOT NULL, 
	world_id VARCHAR, 
	track_id VARCHAR, 
	history JSON NOT NULL, 
	state JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00023s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_chatsession_user_id ON chatsession (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE profile (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	total_xp INTEGER NOT NULL, 
	global_level INTEGER NOT NULL, 
	skill_points INTEGER NOT NULL, 
	world_progress JSON NOT NULL, 
	flags JSON NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (user_id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userskill (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	skill_id VARCHAR NOT NULL, 
	unlocked_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(skill_id) REFERENCES skillnode (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_user_id ON userskill (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userskill_skill_id ON userskill (skill_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE usermetric (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	metric_key VARCHAR NOT NULL, 
	value INTEGER NOT NULL, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_usermetric_user_id ON usermetric (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE userbadge (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	badge_id VARCHAR NOT NULL, 
	awarded_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(badge_id) REFERENCES badgedefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_userbadge_user_id ON userbadge (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE project (
	id VARCHAR NOT NULL, 
	owner_user_id VARCHAR NOT NULL, 
	name VARCHAR NOT NULL, 
	repo_url VARCHAR NOT NULL, 
	provider VARCHAR NOT NULL, 
	source VARCHAR NOT NULL, 
	default_world_id VARCHAR NOT NULL, 
	summary_data JSON NOT NULL, 
	sync_status VARCHAR NOT NULL, 
	last_sync_at DATETIME, 
	codex_status VARCHAR NOT NULL, 
	codex_warnings JSON NOT NULL, 
	codex_last_sync DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(owner_user_id) REFERENCES user (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossrun (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	started_at DATETIME NOT NULL, 
	expires_at DATETIME NOT NULL, 
	completed_at DATETIME, 
	result VARCHAR, 
	score INTEGER NOT NULL, 
	hp_remaining INTEGER NOT NULL, 
	judge_trace_id VARCHAR, 
	notes VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_boss_id ON bossrun (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossrun_user_id ON bossrun (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bossprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	fail_streak INTEGER NOT NULL, 
	highest_hint_level INTEGER NOT NULL, 
	last_attempt_at DATETIME NOT NULL, 
	last_result VARCHAR, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(boss_id) REFERENCES bossdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_user_id ON bossprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00048s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bossprogress_boss_id ON bossprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE questprogress (
	id INTEGER NOT NULL, 
	user_id VARCHAR NOT NULL, 
	quest_id INTEGER NOT NULL, 
	state VARCHAR(11) NOT NULL, 
	attempts INTEGER NOT NULL, 
	best_score FLOAT, 
	last_submitted_at DATETIME, 
	completed_at DATETIME, 
	mastered_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES user (id), 
	FOREIGN KEY(quest_id) REFERENCES questdefinition (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_questprogress_user_id ON questprogress (user_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE projectcodexdoc (
	id INTEGER NOT NULL, 
	project_id VARCHAR NOT NULL, 
	doc_type VARCHAR NOT NULL, 
	title VARCHAR NOT NULL, 
	summary VARCHAR NOT NULL, 
	body_md VARCHAR NOT NULL, 
	world_ids JSON NOT NULL, 
	level INTEGER NOT NULL, 
	tags JSON NOT NULL, 
	metadata_json JSON NOT NULL, 
	created_at DATETIME NOT NULL, 
	updated_at DATETIME NOT NULL, 
	auto_generated BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(project_id) REFERENCES project (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00017s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_project_id ON projectcodexdoc (project_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_projectcodexdoc_doc_type ON projectcodexdoc (doc_type)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
CREATE TABLE bosscodexprogress (
	id INTEGER NOT NULL, 
	profile_id INTEGER NOT NULL, 
	boss_id VARCHAR NOT NULL, 
	tier_unlocked INTEGER NOT NULL, 
	deaths INTEGER NOT NULL, 
	wins INTEGER NOT NULL, 
	first_seen_at DATETIME, 
	first_kill_at DATETIME, 
	updated_at DATETIME NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(profile_id) REFERENCES profile (id)
)


INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00043s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_boss_id ON bosscodexprogress (boss_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00027s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 CREATE INDEX ix_bosscodexprogress_profile_id ON bosscodexprogress (profile_id)
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
------------------------------ Captured log call ------------------------------
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questdefinition (slug, world_id, track_id, order_index, title, short_description, detailed_description, rubric_id, starting_code_path, unlocks_boss_id, unlocks_layout_id, base_xp_reward, mastery_xp_bonus, is_repeatable) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00033s] ('loop', 'world-python', 'python-fundamentals', 0, 'Loop Quest', 'Write a loop', None, None, None, None, None, 50, 25, 0)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO user (id, name, avatar_url, current_avatar_id, created_at) VALUES (?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00030s] ('smoke_test_user', 'Smoke Tester', None, 'default_user', '2025-12-06 03:44:25.347763')
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO profile (user_id, total_xp, global_level, skill_points, world_progress, flags) VALUES (?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00026s] ('smoke_test_user', 0, 1, 0, '{}', '{}')
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT questdefinition.id, questdefinition.slug, questdefinition.world_id, questdefinition.track_id, questdefinition.order_index, questdefinition.title, questdefinition.short_description, questdefinition.detailed_description, questdefinition.rubric_id, questdefinition.starting_code_path, questdefinition.unlocks_boss_id, questdefinition.unlocks_layout_id, questdefinition.base_xp_reward, questdefinition.mastery_xp_bonus, questdefinition.is_repeatable 
FROM questdefinition 
WHERE questdefinition.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00023s] (1,)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO questprogress (user_id, quest_id, state, attempts, best_score, last_submitted_at, completed_at, mastered_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00026s] ('smoke_test_user', 1, 'IN_PROGRESS', 0, None, None, None, None)
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00024s] ('test_session_123',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT chatsession.id AS chatsession_id, chatsession.user_id AS chatsession_user_id, chatsession.mode AS chatsession_mode, chatsession.world_id AS chatsession_world_id, chatsession.track_id AS chatsession_track_id, chatsession.history AS chatsession_history, chatsession.state AS chatsession_state, chatsession.created_at AS chatsession_created_at, chatsession.updated_at AS chatsession_updated_at 
FROM chatsession 
WHERE chatsession.id = ?
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.001966s ago] ('test_session_123',)
ERROR    root:agent.py:551 Stream Error: No module named 'vertexai.generative_models._generative_models'; 'vertexai.generative_models' is not a package
---------------------------- Captured log teardown ----------------------------
INFO     sqlalchemy.engine.Engine:base.py:2705 ROLLBACK
INFO     sqlalchemy.engine.Engine:base.py:2702 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = OFF
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("avatardefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("user")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("chatsession")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("profile")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("skillnode")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userskill")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("usermetric")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("badgedefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("userbadge")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("project")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("projectcodexdoc")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("knowledgechunk")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossrun")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bossprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("bosscodexprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("trackdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questdefinition")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA main.table_info("questprogress")
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bosscodexprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00009s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE projectcodexdoc
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossprogress
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00024s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossrun
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00021s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE project
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userbadge
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE usermetric
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE userskill
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE profile
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE chatsession
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00022s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE user
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00019s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE questdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00018s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE trackdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE bossdefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00015s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE knowledgechunk
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00011s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE badgedefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00010s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE skillnode
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00014s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 
DROP TABLE avatardefinition
INFO     sqlalchemy.engine.Engine:base.py:1846 [no key 0.00016s] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 PRAGMA foreign_keys = ON
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00020s] ()
INFO     sqlalchemy.engine.Engine:base.py:2708 COMMIT
============================== warnings summary ===============================
C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

arcade_app\agent.py:440
  D:\EvalForge\arcade_app\agent.py:440: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\fields.py:656: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return fac()

tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse
  <frozen abc>:106: LangGraphDeprecatedSinceV10: AgentStatePydantic has been moved to `langchain.agents`. Please update your import to `from langchain.agents import AgentStatePydantic`. Deprecated in LangGraph V1.0 to be removed in V2.0.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/backend/test_quest_smoke.py::test_quest_agent_smoke_sse - Assert...
======================== 1 failed, 5 warnings in 5.52s ========================
