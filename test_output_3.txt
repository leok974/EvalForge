============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: D:\EvalForge
plugins: anyio-4.11.0, Faker-37.11.0, langsmith-0.4.38, asyncio-1.2.0, cov-7.0.0, env-1.2.0, httpx-0.35.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 2 items

tests/backend/test_senior_tier_visibility.py::test_senior_progress_api FAILED [ 50%]
tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api FAILED [100%]

================================== FAILURES ===================================
__________________________ test_senior_progress_api ___________________________

client = <httpx.AsyncClient object at 0x000001BDFFD7B380>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x000001BDFFE6A3C0>
test_user = <coroutine object test_user at 0x000001BDFFD87F10>

    async def test_senior_progress_api(client: AsyncClient, db_session, test_user: User):
        """
        Verify /api/profile/senior_progress returns correct aggregation.
        """
        # 1. Setup Data
        # Ensure profile exists (created by fixture usually, but verify)
>       profile = (await db_session.exec(select(Profile).where(Profile.user_id == test_user.id))).first()
                                                                                  ^^^^^^^^^^^^
E       AttributeError: 'coroutine' object has no attribute 'id'

tests\backend\test_senior_tier_visibility.py:33: AttributeError
__________________________ test_senior_boss_runs_api __________________________

client = <httpx.AsyncClient object at 0x000001BDFFEC0910>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x000001BDFFE69E80>
test_user = <coroutine object test_user at 0x000001BD94FF0F40>

    async def test_senior_boss_runs_api(client: AsyncClient, db_session, test_user: User):
        """
        Verify /api/boss_runs/senior returns the history.
        """
        # 1. Setup Data
        senior_boss_id = "boss-synapse-mlops-sentinel" # ML Senior
    
        boss_def = BossDefinition(
            id=senior_boss_id,
            name="ML Sentinel",
            track_id="synapse-senior-mlops",
            world_id="world-ml",
            difficulty="legendary"
        )
        db_session.add(boss_def)
    
        run = BossRun(
>           user_id=test_user.id,
                    ^^^^^^^^^^^^
            boss_id=senior_boss_id,
            result="win",
            score=8,
            hp_remaining=90, # 90% integrity
            completed_at=datetime.utcnow()
        )
E       AttributeError: 'coroutine' object has no attribute 'id'

tests\backend\test_senior_tier_visibility.py:113: AttributeError
============================== warnings summary ===============================
C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

arcade_app\agent.py:449
  D:\EvalForge\arcade_app\agent.py:449: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\fastapi\applications.py:4523: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/backend/test_senior_tier_visibility.py::test_senior_progress_api
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_senior_progress_api' requested an async fixture 'test_user', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/backend/test_senior_tier_visibility.py::test_senior_progress_api
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_senior_progress_api' requested async @pytest.fixture 'test_user' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_senior_boss_runs_api' requested an async fixture 'test_user', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_senior_boss_runs_api' requested async @pytest.fixture 'test_user' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\sql\visitors.py:481: RuntimeWarning: coroutine 'test_user' was never awaited
    return itertools.chain.from_iterable(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api
tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api
  C:\Users\pierr\AppData\Roaming\Python\Python313\site-packages\pydantic\fields.py:656: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return fac()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/backend/test_senior_tier_visibility.py::test_senior_progress_api
FAILED tests/backend/test_senior_tier_visibility.py::test_senior_boss_runs_api
======================= 2 failed, 10 warnings in 1.46s ========================
<sys>:0: RuntimeWarning: coroutine 'test_user' was never awaited
